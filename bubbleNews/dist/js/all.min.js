angular.module("myApp",["ionic","myApp.httpFactory","myApp.slideBox","myApp.tabs","myApp.news","myApp.search","myApp.live","myApp.topic","myApp.personal","myApp.newsSummaryC","myApp.newsFactory"]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(e,t,o){o.views.transition("ios"),o.tabs.position("bottom"),o.navBar.alignTitle("center"),o.tabs.style("standard"),e.state("tabs",{url:"/tabs",abstract:!0,templateUrl:"tabs.html",controller:"tabsController"}),t.otherwise("tabs/news")}]),angular.module("myApp.live",[]).config(["$stateProvider",function(e){e.state("tabs.live",{url:"/live",views:{"tabs-live":{templateUrl:"live.html",controller:"liveController"}}})}]).controller("liveController",["$scope",function(e){}]),angular.module("myApp.news",[]).config(["$stateProvider",function(e){e.state("tabs.news",{url:"/news",views:{"tabs-news":{templateUrl:"news.html",controller:"newsController"}}})}]).controller("newsController",["$scope","$ionicPopup","$ionicSlideBoxDelegate","HttpFactory","$ionicLoading","$state","$ionicViewSwitcher","$rootScope","$timeout",function(e,t,o,n,r,i,a,l,s){e.scrollItems=["头条","要闻","娱乐","体育","网易号","郑州","视频","财经","科技","汽车","时尚","图片","直播","热点","跟帖","房产","股票","家居","独家","游戏"],e.news={newsArray:[],adsArray:[],index:0,isFirst:!0},e.loadMore=function(){e.show(),url="http://c.m.163.com/recommend/getSubDocPic?from=toutiao&prog=LMA1&open=&openpath=&fn=1&passport=&devId=%2BnrKMbpU9ZDPUOhb9gvookO3HKJkIOzrIg%2BI9FhrLRStCu%2B7ZneFbZ30i61TL9kY&offset="+e.news.index+"&size=10&version=17.1&spever=false&net=wifi&lat=&lon=&ts=1480666192&sign=yseE2FNVWcJVjhvP48U1nPHyzZCKpBKh%2BaOhOE2d6GR48ErR02zJ6%2FKXOnxX046I&encryption=1&canal=appstore",0===e.news.index?e.news.index+=11:e.news.index+=10,n.getData(url).then(function(t){return e.hide(),t?(e.news.adsArray.length||t[0].ads&&(e.news.adsArray=t[0].ads),e.news.newsArray=e.news.newsArray.concat(t),0===e.news.index&&e.news.newsArray.splice(0,1),e.$broadcast("scroll.infiniteScrollComplete"),void console.log(e.news.newsArray)):void alert("没有更多数据!")},function(){e.hide()})},e.doRefresh=function(){url="http://c.m.163.com/recommend/getSubDocPic?from=toutiao&prog=LMA1&open=&openpath=&fn=1&passport=&devId=%2BnrKMbpU9ZDPUOhb9gvookO3HKJkIOzrIg%2BI9FhrLRStCu%2B7ZneFbZ30i61TL9kY&offset="+e.news.index+"&size=10&version=17.1&spever=false&net=wifi&lat=&lon=&ts=1480666192&sign=yseE2FNVWcJVjhvP48U1nPHyzZCKpBKh%2BaOhOE2d6GR48ErR02zJ6%2FKXOnxX046I&encryption=1&canal=appstore",n.getData(url).then(function(t){return t?(e.news.adsArray.length||t[0].ads&&(e.news.adsArray=t[0].ads),e.news.newsArray=t,0===e.news.index&&e.news.newsArray.splice(0,1),void e.$broadcast("scroll.refreshComplete")):void alert("没有更多数据!")})},e.dragOpenSlide=function(){o.$getByHandle("mainSlideBox").enableSlide(!0)},e.slideChanged=function(){o.$getByHandle("mainSlideBox").enableSlide(!1)},e.btnArray=["头条","要闻","娱乐","体育","郑州","视频","财经","科技","汽车","时尚","图片","直播","热点","跟帖","房产","股票","家居","网易号","独家","游戏"],e.boolChange=!0,e.openBnts=function(){var t=document.querySelector("#btnIcon"),o=document.querySelector("#btnDiv");e.boolChange?(t.setAttribute("style","transform:rotate(180deg)"),o.style.height="1000px",e.boolChange=!1,s(function(){l.hideTabs=!0},700)):(t.setAttribute("style","transform:rotate(0deg)"),o.style.height="0",e.boolChange=!0,s(function(){l.hideTabs=!1},600))},e.goDetail=function(t){console.log(t),console.log(e.news.newsArray);var o=e.news.newsArray[t].docid;console.log(o),i.go("newsSummary",{data:o}),a.nextDirection("forward"),e.show()},e.hide=function(){r.hide()}}]),angular.module("myApp.newsFactory",[]).factory("NewsFactory",["$http",function(e){return{getNewsData:function(t,o){var t=t;e({url:t,method:"GET",timeout:12e3,cache:!0}).then(function(e){e=e.data,console.log(e),o(e)},function(e){console.log("发生请求错误"+e)})}}}]),angular.module("myApp.newsSummaryC",[]).config(["$stateProvider",function(e){e.state("newsSummary",{url:"/newsSummary",templateUrl:"newsSummary.html",controller:"newsSummaryController",params:{data:null}})}]).controller("newsSummaryController",["$scope","$stateParams","NewsFactory","$sce","$ionicLoading",function(e,t,o,n,r){var i=t.data;e.newsSummary={detail:"",body:"",goBackView:function(){window.history.go(-1)}};var a="http://localhost:3000/?myUrl=http://c.m.163.com/nc/article/"+i+"/full.html";o.getNewsData(a,function(t){e.hide(),e.newsSummary.detail=t[i],console.log(e.newsSummary.detail);var o=e.newsSummary.detail;if(console.log(o),o.img&&o.img.length)for(var r=0;r<o.img.length;r++){var a=o.img[r].pixel.split("*")[0];a>document.body.offsetWidth&&(a=document.body.offsetWidth);var l="width:"+a+"px",s="<img style='"+l+"' src="+o.img[r].src+">";o.body=o.body.replace(o.img[r].ref,s)}e.newsSummary.body=n.trustAsHtml(o.body)}),e.hide=function(){r.hide()}}]),angular.module("myApp.personal",[]).config(["$stateProvider",function(e){e.state("tabs.personal",{url:"/personal",views:{"tabs-personal":{templateUrl:"personal.html",controller:"personalController"}}})}]).controller("personalController",["$scope",function(e){}]),angular.module("myApp.search",[]).config(["$stateProvider",function(e){e.state("tabs.search",{url:"/search",views:{"tabs-news":{templateUrl:"search.html",controller:"searchController"}}})}]).controller("searchController",["$scope",function(e){}]),angular.module("myApp.tabs",[]).controller("tabsController",["$scope","$ionicLoading",function(e,t){e.$on("$stateChangeSuccess",function(e,t,o){var n=function(e){document.getElementsByTagName("body")[0];document.title=e;var t=document.createElement("iframe");t.setAttribute("src","../empty.png"),t.addEventListener("load",function(){setTimeout(function(){document.body.removeChild(t)})}),document.body.appendChild(t)};switch(t.url){case"/news":n("新闻");break;case"/live":n("直播");break;case"/topic":n("话题");break;case"/personal":n("我")}}),e.show=function(){t.show({template:'<ion-spinner icon="ios"></ion-spinner>',noBackdrop:!0})}}]).directive("showTabs",function(e){return{restrict:"A",link:function(t,o){e.hideTabs=!1}}}).directive("hideTabs",function(e){return{restrict:"A",link:function(t,o){e.hideTabs=!0}}}),angular.module("myApp.topic",[]).config(["$stateProvider",function(e){e.state("tabs.topic",{url:"/topic",views:{"tabs-topic":{templateUrl:"topic.html",controller:"topicController"}}})}]).controller("topicController",["$scope",function(e){}]),angular.module("myApp.httpFactory",[]).factory("HttpFactory",["$http","$q",function(e,t){return{getData:function(o,n){if(o){var r=t.defer();return o="http://localhost:3000/?myUrl="+encodeURIComponent(o),n=n?n:"GET",e({url:o,method:n,timeout:2e4}).then(function(e){e=e.data,e=e[Object.keys(e)[0]],r.resolve(e)},function(e){r.reject(e)}),r.promise}}}}]),angular.module("myApp.slideBox",[]).directive("mgSlideBox",[function(){return{restrict:"E",scope:{sourceArray:"="},template:'<div class="topCarousel"><ion-slide-box delegate-handle="topCarouselSlideBox" on-slide-changed="slideHasChanged($index)" auto-play="true" slide-interval="1000" show-pager="true" does-continue="true" ng-if="isShowSlideBox" on-drag="drag($event)"> <ion-slide ng-repeat="ads in sourceArray track by $index" ng-click="goToDetailView($index)"><img ng-src="{{ads.imgsrc}}" class="topCarouselImg"></ion-slide></ion-slide-box><div class="slideBottomDiv"></div></div>',controller:["$scope","$element","$ionicSlideBoxDelegate","$state","$ionicViewSwitcher",function(e,t,o,n,r){var i=t[0].lastElementChild;e.goToDetailView=function(e){console.log(i),n.go("newsSummary"),r.nextDirection("forward"),console.log("进入详情页"+e)},e.$watch("sourceArray",function(t,o){t&&t.length&&(e.isShowSlideBox=!0,i.innerText=e.sourceArray[0].title)}),e.slideHasChanged=function(t){i.innerText=e.sourceArray[t].title},e.drag=function(e){o.$getByHandle("mainSlideBox").enableSlide(!1),e.stopPropagation()}}],replace:!0,link:function(e,t,o){}}}]);